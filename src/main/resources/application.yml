spring:
  application:
    name: matchimban-api

  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/matchimban}
    username: ${DB_USERNAME:matchimban}
    password: ${DB_PASSWORD:matchimban}
    driver-class-name: org.postgresql.Driver
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    properties:
      hibernate:
        format_sql: true

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}

kakao:
  oauth:
    authorize-url: ${KAKAO_AUTHORIZE_URL:https://kauth.kakao.com/oauth/authorize}
    token-url: ${KAKAO_TOKEN_URL:https://kauth.kakao.com/oauth/token}
    user-info-url: ${KAKAO_USER_INFO_URL:https://kapi.kakao.com/v2/user/me}
    unlink-url: ${KAKAO_UNLINK_URL:https://kapi.kakao.com/v1/user/unlink}
    client-id: ${KAKAO_CLIENT_ID:}
    client-secret: ${KAKAO_CLIENT_SECRET:}
    redirect-uri: ${KAKAO_REDIRECT_URI:}
    frontend-redirect-url: ${KAKAO_FRONTEND_REDIRECT_URL:/}
    admin-key: ${KAKAO_ADMIN_KEY:}
    connect-timeout: ${KAKAO_CONNECT_TIMEOUT:2s}
    read-timeout: ${KAKAO_READ_TIMEOUT:3s}

jwt:
  secret: ${JWT_SECRET:}
  issuer: ${JWT_ISSUER:matchimban}
  access-token-expire-minutes: ${JWT_ACCESS_TOKEN_EXPIRE_MINUTES:60}
  cookie-name: ${JWT_COOKIE_NAME:access_token}
  refresh-cookie-name: ${JWT_REFRESH_COOKIE_NAME:refresh_token}
  refresh-token-expire-days: ${JWT_REFRESH_TOKEN_EXPIRE_DAYS:7}
  cookie-secure: ${JWT_COOKIE_SECURE:false}
  cookie-same-site: ${JWT_COOKIE_SAME_SITE:Lax}

management:
  endpoints:
    web:
      exposure:
        include: health, prometheus

resilience4j:
  circuitbreaker:
    instances:
      kakao:
        sliding-window-type: COUNT_BASED # 호출 수 기준으로 실패율 집계
        sliding-window-size: 20 # 최근 20건 호출을 기준으로 계산
        minimum-number-of-calls: 10 # 최소 10건부터 실패율/슬로우콜 비율 계산
        failure-rate-threshold: 50 # 실패율 50% 이상이면 OPEN
        slow-call-rate-threshold: 50 # 느린 호출 비율이 50% 이상이면 OPEN
        slow-call-duration-threshold: 2s # 2초 이상 걸리면 느린 호출로 집계
        wait-duration-in-open-state: 10s # OPEN 유지 시간 (이후 HALF_OPEN 전환)
        permitted-number-of-calls-in-half-open-state: 3 # HALF_OPEN에서 허용할 테스트 호출 수
  thread-pool-bulkhead:
    instances:
      kakao:
        core-thread-pool-size: 10 # 기본 스레드 수
        max-thread-pool-size: 20 # 폭주시 최대 스레드 수
        queue-capacity: 20 # 대기열 크기(대기/지연 허용 범위)
        keep-alive-duration: 20s # 추가 스레드가 놀 때 유지 시간

csrf:
  cookie-domain: ${CSRF_COOKIE_DOMAIN:}

ai-recommendation:
  base-url: ${AI_RECOMMENDATION_BASE_URL:http://localhost:8000/api/v1}
  timeout-ms: 5000
